# TimeFlow API 规划

本文档概述了 TimeFlow 应用的 RESTful API 结构，旨在支持云同步等功能。

## API 设计原则

- **版本控制:** 所有端点都以 `/api/v1` 作为前缀。
- **身份认证:** 受保护的端点需要在 `Authorization` 请求头中提供 JWT Bearer 令牌。
- **数据格式:** 所有请求和响应体均使用 `application/json`。

---

## 1. 用户认证 API (`/auth`)

处理用户注册和登录，可公开访问。

| 方法     | 端点               | 描述              | 认证  |
|:-------|:-----------------|:----------------|:----|
| `POST` | `/auth/register` | 注册一个新用户。        | [ ] |
| `POST` | `/auth/login`    | 用户登录并获取 JWT 令牌。 | [ ] |
| `GET`  | `/users/me`      | 获取当前已登录用户的个人资料。 | [x] |

---

## 2. 课程表 API (`/schedules`)

管理用户的课程表集合。

| 方法       | 端点                | 描述                   | 认证  |
|:---------|:------------------|:---------------------|:----|
| `GET`    | `/schedules`      | 获取当前用户的所有课程表列表。      | [x] |
| `POST`   | `/schedules`      | 创建一个新的课程表。           | [x] |
| `GET`    | `/schedules/{id}` | 获取指定 ID 的单个课程表的完整信息。 | [x] |
| `PUT`    | `/schedules/{id}` | 完整更新一个指定的课程表。        | [x] |
| `DELETE` | `/schedules/{id}` | 删除一个指定的课程表。          | [x] |

---

## 3. 课程 API (`/schedules/{scheduleId}/courses`)

管理特定课程表内的课程。注意：这些操作也可以通过更新父级 `Schedule` 对象（通过 `PUT /schedules/{id}`）来间接实现。

| 方法       | 端点                                           | 描述               | 认证  |
|:---------|:---------------------------------------------|:-----------------|:----|
| `POST`   | `/schedules/{scheduleId}/courses`            | 在指定课程表中添加一门新课程。  | [x] |
| `PUT`    | `/schedules/{scheduleId}/courses/{courseId}` | 更新指定课程表中的一门特定课程。 | [x] |
| `DELETE` | `/schedules/{scheduleId}/courses/{courseId}` | 从指定课程表中删除一门课程。   | [x] |

---

## 4. 用户设置 API (`/settings`)

同步用户专属的应用设置。

| 方法    | 端点          | 描述         | 认证  |
|:------|:------------|:-----------|:----|
| `GET` | `/settings` | 获取用户的完整设置。 | [x] |
| `PUT` | `/settings` | 完整更新用户的设置。 | [x] |

---

## 5. 云同步 API (`/sync`)

为提升用户体验，设计一个专门的、基于增量同步的端点，以减少网络请求次数。

| 方法     | 端点      | 描述                      | 认证  |
|:-------|:--------|:------------------------|:----|
| `POST` | `/sync` | 执行一次完整的同步操作，交换本地与云端的变更。 | [x] |

### 同步流程示例:

1. **客户端到服务端**: 客户端发送一个 `POST` 请求，其中包含它上次同步的时间戳 (`lastSyncTimestamp`)，以及在本地发生的所有增、删、改操作。
2. **服务端到客户端**:
   服务器处理客户端的变更，然后找出从客户端上次同步至今，在云端发生的所有变更，最后将这些变更连同一个新的时间戳 (
   `newSyncTimestamp`) 一并返回给客户端。
